# Global Claude Code Instructions

## Workflow Preferences

- **auto-git-workflow**: Always use the `/git-workflow` skill (not manual git commands) for feature branch work. Follow the skill step-by-step—every phase is mandatory. Complete phases without pausing for explicit user prompts.
- **auto-cleanup-after-merge**: After merging a PR (whether user merges or Claude merges), automatically clean up local git: checkout main, pull, delete merged feature branches.
- **practice-review-prompts**: At the end of substantive sessions (meaningful work, not quick questions), offer to run `/practice-review` if the session touched areas covered by `~/.claude/practices.md`. Phrase as: "This session touched [area]. Want to run `/practice-review` to reflect on how it went?"

## Bug Fix Workflow

When implementing ANY bugfix—whether from:
- A bug report ("X is not working", "X is broken")
- A plan that fixes a bug
- A PR review comment about a bug
- A failing test investigation

**ALWAYS:**
1. Invoke `/tdd-bugfix` skill FIRST, before writing any fix code
2. Write a failing test that reproduces the bug
3. THEN implement the fix
4. Never rationalize skipping tests because code is "hard to test"
   - If testing requires infrastructure, BUILD the infrastructure
   - That infrastructure has value for future development
   - "Manual testing" is not acceptable for agentic workflows

## Development Conventions

- **Playwright screenshots**: Always use `downloadsDir: "/tmp"` when taking screenshots to avoid polluting ~/Downloads

## Skills Editing Workflow

When editing skills in `~/.claude/skills/`:
1. Skills are stored in a git repo (dotfiles)
2. After editing, commit changes: `cd ~/.claude/skills && git add . && git commit -m "Update {skill-name}: {description}"`
3. Push to remote: `git push`

## Validate User Assumptions

When user references specific files/repos by name:
1. Search to verify they exist
2. If found in different locations than stated, mention it: "I found X in {actual} instead of {stated}"
3. If not found where stated, ask for clarification before proceeding

## Research Before Implementing

When asked to add a pattern/feature:
1. Search for existing examples (Glob/Grep)
2. Read 2-3 examples to understand the pattern
3. Read target file to understand structure
4. Make comprehensive updates (not just minimum)
5. Only ask if pattern is unclear or examples conflict

## Architecture Principle Hierarchy

General principles live in the `architecture-astronaut` agent. Project-specific applications and nuances live in each project's `ARCHITECTURE.md`.

**Bidirectional sync:**

1. **When updating a project's ARCHITECTURE.md with a new principle:**
   - Ask: Is this principle general or project-specific?
   - If general → add to `architecture-astronaut` agent, keep project ARCHITECTURE.md as application/example
   - If project-specific → keep only in project ARCHITECTURE.md

2. **When updating `architecture-astronaut` with a new principle:**
   - Vet relevant project ARCHITECTURE.md files for compliance
   - Projects don't need to duplicate—general principles can live only in the agent
   - Add project-specific entries only when the application is nuanced for that project

3. **After any architectural change:**
   - Run `architecture-astronaut` to verify code compliance
   - Report findings proactively, don't wait to be asked

## Architecture Review

Projects may have an **ARCHITECTURE.md** file (generated by `/establish-ai`) that documents design philosophy, core principles, and patterns. When working on non-trivial projects:

1. Check for ARCHITECTURE.md at project root or in docs/
2. Read it before making architectural changes
3. Use the **architecture-astronaut** agent for code structure reviews, integration planning, or evaluating architectural decisions
4. Update ARCHITECTURE.md when making significant architectural changes
